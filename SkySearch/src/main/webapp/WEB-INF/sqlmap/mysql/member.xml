<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">
	<select id="list" resultType="Map" parameterType="Map">
		SELECT 
		member.MEMBER_SEQ,
		member.EMAIL,
		member.PASSWORD,
		member.NAME,
		member.PHONE,
		member.ENABLE,
		local.LOCAL_NAME
		FROM skysearch.ss_member member left JOIN skysearch.ss_int_local int_local
		ON member.MEMBER_SEQ = int_local.MEMBER_SEQ left JOIN skysearch.ss_local local
		ON int_local.local_SEQ = local.local_SEQ
		ORDER BY NAME ASC;
	</select>

	<select id="read" resultType="Map" parameterType="String">
		select
		member.MEMBER_SEQ,
		member.EMAIL,
		member.PASSWORD,
		member.NAME,
		member.PHONE,
		local.LOCAL_NAME
		FROM skysearch.ss_member member left JOIN skysearch.ss_int_local int_local
		ON member.MEMBER_SEQ = int_local.MEMBER_SEQ left JOIN skysearch.ss_local local
		ON int_local.local_SEQ = local.local_SEQ
		where member.EMAIL='system@skysearch.com'
		
		</select>
		
		<select id="check" resultType="Map" parameterType="Map">
		select 
			EMAIL, NAME, PHONE, PASSWORD
			from SS_MEMBER 
			where NAME = #{NAME}
		</select>

	<insert id="merge" parameterType="Map">
		<selectKey keyProperty="MEMBER_SEQ" resultType="String"
			order="AFTER">	<!-- order="BEFORE" -->
			SELECT MEMBER_SEQ
			FROM skysearch.ss_member
			WHERE MEMBER_SEQ =
			#{MEMBER_SEQ}
		</selectKey>
		<!--selectKey resultType="String" keyProperty="MEMBER_SEQ" order="AFTER"> 
			SELECT MEMBER_SEQ FROM CIP_MEMBER WHERE MEMBER_SEQ = #{MEMBER_SEQ} </selectKey -->
		INSERT INTO skysearch.ss_member(
		MEMBER_SEQ
		,EMAIL
		,PASSWORD
		,NAME
		,PHONE
		,ENABLE
		,REGISTER_SEQ
		,REGISTRY_DATE
		,MODIFIER_SEQ
		,MODIFY_DATE
		)
		VALUES(
		#{MEMBER_SEQ}
		, #{EMAIL}
		, #{PASSWORD}
		, #{NAME}
		, #{PHONE}
		, #{ENABLE}
		, #{REGISTER_SEQ}
		, now()
		, #{MODIFIER_SEQ}
		, now() )
		ON DUPLICATE KEY UPDATE
		EMAIL = #{EMAIL}
		, PASSWORD = #{PASSWORD}
		, NAME = #{NAME}
		, PHONE = #{PHONE}
		, INT_LOCAL = #{INT_LOCAL}
		, MODIFIER_SEQ = #{MODIFIER_SEQ}
		, MODIFY_DATE = now()
	</insert>

	<update id="delete" parameterType="Map">
 		update skysearch.ss_member 
		set ENABLE='N'
		where EMAIL = #{EMAIL} and PASSWORD = #{PASSWORD}
	</update>
</mapper>

<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="travel">
	
	<!-- 도시에 대한 조회수를 1증가시킨다. -->
	<update id="view" parameterType="Map">
		UPDATE SS_CITY
		SET CITY_VIEWS = CITY_VIEWS+1
		WHERE CITY_SEQ = #{CITY_SEQ}
	</update>
	
	<!-- 도시에 대한 정보를 처음 가져온다. -->
	<select id="read" resultType="Map" parameterType="Map">
		SELECT
		CITY_SEQ, <!-- 도시 시퀀스 --> 
		CITY_NAME, <!-- 도시 이름 -->
		CITY_ADD, <!-- 도시 주소 --> 
		CITY_LATITUDE, <!-- 위도 -->
		CITY_LONGITUDE, <!-- 경도 -->
		CITY_VIEWS <!-- 조회수 -->
		FROM 
		SS_CITY
		WHERE
		CITY_SEQ = #{CITY_SEQ}
	</select>
	
	<!-- 관광지 정보에 대한 리스트를 가져온다. -->
	<select id='landmark' resultType="Map" parameterType="Map">
		SELECT 
		LANDMARK_NAME, 
		LANDMARK_EXP, 
		LANDMARK_ADDR
		FROM 
		SS_TRAVEL_INFO
		WHERE 
		CITY_SEQ = #{CITY_SEQ}
	</select>
	
	<!-- 댓글에 대한 리스트를 가져온다. -->
	<select id='comment' resultType="Map" parameterType="Map">
		SELECT 
		m.NAME AS MEMBER_NAME, 
		m.MEMBER_SEQ,
		c.COMMENT_CON, 
		c.SS_STAR, 
		c.REGISTRY_DATE
		FROM 
		SS_MEMBER m, SS_COMMENT c
		WHERE 
		m.MEMBER_SEQ = c.MEMBER_SEQ
		AND 
		c.CITY_SEQ = #{CITY_SEQ}   
	</select>
	
	<!-- 페이징 -->
	<select id="listpagination" resultType="Map" parameterType="Map">
		select result.*
		from (
		select rownum as rn, member.*
		from ( select * from CIP_MEMBER
		order by NAME ) member 
		) result
		where result.rn between #{pagination.pageBegin} and #{pagination.pageEnd}
	</select>
	
	<!-- 댓글의 갯수 가져오기 -->
	<select id="totalcount" resultType="integer" parameterType="Map">
		SELECT 
		count(MEMBER_SEQ)
		FROM 
		SS_MEMBER
	</select>
	<!-- 페이징 끝 -->
	
	<!-- 댓글 달기 -->
	<insert id="setcomment" parameterType="Map">
		INSERT INTO 
		SS_COMMENT
		VALUES(
		#{COMMENT_SEQ},
		#{MEMBER_SEQ},
		#{CITY_SEQ},
		#{COMMENT_CON},
		'Y',
		#{SS_STAR},
		#{MEMBER_SEQ},
		now(),
		#{MEMBER_SEQ},
		now()
		)
		
	</insert>
	
	<!-- 셀렉트 박스에서 입력된 대륙에 해당하는 국가를 가져온다. -->
	<select id="country" resultType="Map" parameterType="Map">
		SELECT 
		c.COUNTRY_NAME, <!-- 국가명 -->
		c.COUNTRY_SEQ <!-- 국가시퀀스 -->
		FROM 
		SS_LOCAL l, SS_COUNTRY c
		WHERE l.LOCAL_SEQ = c.LOCAL_SEQ 
		AND 
		LOCAL_NAME = #{LOCAL_NAME}
	</select>
	
	<!-- 셀렉트 박스에서 입력된 국가에 해당하는 도시를 가져온다. -->
	<select id="city" resultType="Map" parameterType="Map">
		SELECT 
		ci.CITY_NAME, 
		ci.CITY_SEQ
		FROM 
		SS_COUNTRY co, SS_CITY ci
		WHERE 
		co.COUNTRY_SEQ = ci.COUNTRY_SEQ
		AND 
		co.COUNTRY_SEQ = #{COUNTRY_SEQ}
	</select>

</mapper>